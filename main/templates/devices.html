{% extends "base.html" %}

{% block content %}
<div class="card-group">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <!-- Card -->
    {% for device in devices %}
    <div class="card" style="width: 52rem; max-width: 80vw;">

        <div class="card-body">
            <p id={{device.device_id}} class="text-uppercase small mb-2"><strong>Last Run:</strong></p>
            <h5 class="font-weight-bold mb-0">ID:{{device.device_id}}</h5>
        </div>

        <hr class="my-0">

        <div class="card-body">
            <canvas id="lineChart-{{device.device_id}}"></canvas>
        </div>
    </div>
    <script>
        var dvc = "{{ device.device_id}}";
        var temp = "{{ device.temperature}}";
        temp = Array.from(temp);
        var hum = "{{ device.humidity}}";
        hum = Array.from(hum);
        var moi = "{{ device.moisture}}";
        moi = Array.from(moi);
        var labels = []
        console.log("lolz")
        console.log(dvc)
        console.log(temp.length)
        var lr = " More than an hour ago"
        for (let i = 0; i < temp.length; i++) {
            if (dvc.moisture_level < 0) {
                lr = " " + string(temp.length - i - 1) + " min ago"
            }
            labels.push([i])
        }
        document.getElementById(dvc).innerHTML = document.getElementById(dvc).innerHTML + lr
        var ctxL = document.getElementById("lineChart-" + dvc).getContext('2d'); var myLineChart = new
            Chart(ctxL, {
                type: 'line', data: {
                    labels: labels,
                    datasets: [
                        {
                            label: "Temperature",
                            data: temp,
                            backgroundColor: ['rgba(105, 0, 132, .2)',],
                            borderColor: ['rgba(200, 99, 132, .7)'
                                ,],
                            borderWidth: 2
                        },
                        {
                            label: "Humidity",
                            data: hum,
                            backgroundColor:
                                ['rgba(0, 137, 132, .2)',],
                            borderColor: ['rgba(0, 10, 130, .7)',],
                            borderWidth: 2
                        },
                        {
                            label: "Moisture",
                            data: moi,
                            backgroundColor:
                                ['rgba(14, 198, 14, .2)',],
                            borderColor: ['rgba(14, 198, 14, .7)',],
                            borderWidth: 2
                        }
                    ]
                }, options:
                    { responsive: true }
            }); 
    </script>
    {% endfor %}
    <!-- Card -->

</div>

{% endblock content%}